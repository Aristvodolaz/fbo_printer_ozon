# Система печати маркировок OZON FBO с отслеживанием прогресса в БД

Система для автоматической печати маркировок OZON FBO с сохранением прогресса в базе данных SQL Server. Прогресс сохраняется при каждой печати и автоматически загружается при открытии задания на любом компьютере.

## Возможности

- ✅ Автоматическая печать маркировок по номеру ВПС
- ✅ Сохранение прогресса печати в БД SQL Server
- ✅ Автоматическая загрузка прогресса при открытии задания
- ✅ Продолжение работы с задания на другом компьютере
- ✅ Отслеживание статистики печати

## Установка

### Требования
- **Node.js 18.0.0 или выше** (рекомендуется 18.x или 20.x)
- **SQL Server** с доступом к базе данных

### 1. Установка зависимостей

```bash
npm install
```

**Примечание:** Если у вас Node.js 18.x, используется `mssql@9.x` для совместимости. Если Node.js 20+, можно использовать `mssql@10.x`.

### 2. Создание таблицы в БД

Таблица создастся автоматически при первом запуске сервера. Или можно создать вручную, выполнив SQL скрипт:

```bash
# Через SQL Server Management Studio или другой клиент
# Выполните файл create-table.sql
```

Или программно:

```bash
npm run create-table
```

### 3. Запуск сервера

#### Windows:
Просто запустите `start.bat` или:
```bash
npm start
```

#### Linux/Mac:
```bash
npm start
```

Сервер запустится на `http://localhost:3000`

### 4. Открытие приложения

Откройте в браузере:
```
http://localhost:3000
```

Или если запускаете на сервере:
```
http://<IP_СЕРВЕРА>:3000
```

**Примечание:** HTML файл `index.html` автоматически раздается сервером как главная страница.

## Использование

1. **Загрузите Excel файл** с привязкой (колонки: Маркировка (A) и ВПС (B))
   - Название файла будет использовано как название задания в БД
   - При загрузке автоматически загрузится прогресс из БД (если есть)

2. **Загрузите PDF файл** с маркировками

3. **Введите номер ВПС** и нажмите Enter или кнопку поиска
   - Система найдет маркировку и отправит на печать
   - Прогресс автоматически сохранится в БД

4. **При переносе на другой компьютер:**
   - Загрузите тот же Excel файл (с тем же именем)
   - Прогресс автоматически загрузится из БД
   - Можно продолжать печать с того места, где остановились

## Структура БД

Таблица `LabelPrintProgress`:

- `Id` - Уникальный идентификатор
- `TaskName` - Название задания (имя Excel файла)
- `VpsNumber` - Номер ВПС (оригинальный)
- `NormalizedVps` - Нормализованный номер ВПС (для поиска)
- `Marking` - Маркировка товара
- `PrintedAt` - Время последней печати
- `CreatedAt` - Время создания записи

## API Endpoints

- `POST /api/progress/save` - Сохранение прогресса печати
- `GET /api/progress/load/:taskName` - Загрузка прогресса задания
- `GET /api/progress/stats/:taskName` - Статистика по заданию
- `DELETE /api/progress/delete/:taskName` - Удаление прогресса задания
- `GET /api/health` - Проверка статуса сервера

## Конфигурация БД

Конфигурация подключения находится в файле `db.js`:

```javascript
const config = {
    user: 'sa',
    password: 'icY2eGuyfU',
    server: 'PRM-SRV-MSSQL-01.komus.net',
    port: 59587,
    database: 'SPOe_rc',
    // ...
};
```

## Примечания

- Если API сервер недоступен, система продолжит работать без сохранения в БД
- Название задания определяется по имени Excel файла (без расширения)
- Прогресс загружается автоматически при загрузке Excel файла
- Каждая печать сохраняется в БД асинхронно, не блокируя работу интерфейса
# fbo_printer_ozon
